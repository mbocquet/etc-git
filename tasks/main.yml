---
# tasks file for etc-git
- name: "package"
  package:
    name: git
  tags:
    - etc-git
    - package

- name: "check if repo already exists"
  stat:
    path: /etc/.git
  register: gitRepo
  tags:
    - etc-git
    - check

- name: ".gitignore"
  template:
    src: gitignore.j2
    dest: /etc/.gitignore
    mode: 0644
    backup: false
  tags:
    - etc-git
    - gitignore

- name: "create repository and add files"
  shell: cd /etc && git init . && git add .
  when: gitRepo.stat.isdir is not defined
  tags:
    - etc-git
    - create

- name: "configure user.email"
  git_config:
    name: user.email
    repo: /etc
    scope: local
    value: "root@{{ ansible_hostname }}"
  when: not ansible_check_mode
  tags:
    - etc-git
    - configure

- name: "first commit"
  shell: cd /etc && git commit -m "initial commit"
  when: gitRepo.stat.isdir is not defined
  tags:
    - etc-git
    - commit
...
